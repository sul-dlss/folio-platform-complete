(window.webpackJsonp=window.webpackJsonp||[]).push([[22],{2758:function(e,t,r){"use strict";r.r(t);var n=r(3),o=r.n(n),a=r(1),i=r.n(a),s=r(4),c=r(142),u=r.n(c),l=r(209),d=r(7),p=r(9),f=r(2948),g=r(1395),m=r(20),h=r(2985),b=r(29),j=r(2),y=r(2968),O=r(0);function v(e){return(v="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function w(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function E(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?w(Object(r),!0).forEach((function(t){P(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):w(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function P(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function R(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function x(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function A(e,t){return(A=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function S(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=L(e);if(t){var o=L(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return k(this,r)}}function k(e,t){if(t&&("object"===v(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}function L(e){return(L=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var D=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&A(e,t)}(a,e);var t,r,n,o=S(a);function a(){var e;R(this,a);for(var t=arguments.length,r=new Array(t),n=0;n<t;n++)r[n]=arguments[n];return(e=o.call.apply(o,[this].concat(r))).cloneableProperties=[{key:"agreementInfo",value:Object(O.jsx)(b.a,{id:"ui-agreements.duplicateAgreementModal.agreementInfo"})},{key:"internalContacts",value:Object(O.jsx)(b.a,{id:"ui-agreements.duplicateAgreementModal.internalContacts"})},{key:"agreementLines",value:Object(O.jsx)(b.a,{id:"ui-agreements.duplicateAgreementModal.agreementLines"})},{key:"linkedLicenses",value:Object(O.jsx)(b.a,{id:"ui-agreements.duplicateAgreementModal.linkedLicenses"})},{key:"externalLicenses",value:Object(O.jsx)(b.a,{id:"ui-agreements.duplicateAgreementModal.externalLicenses"})},{key:"organizations",value:Object(O.jsx)(b.a,{id:"ui-agreements.duplicateAgreementModal.organizations"})},{key:"supplementaryInformation",value:Object(O.jsx)(b.a,{id:"ui-agreements.duplicateAgreementModal.supplementaryInformation"})},{key:"usageData",value:Object(O.jsx)(b.a,{id:"ui-agreements.duplicateAgreementModal.usageData"})}],e.translationIds={cloneEndpointError:"ui-agreements.duplicateAgreementModal.cloneEndpointError",duplicateModalLabel:"ui-agreements.duplicateAgreementModal.duplicateAgreement",duplicateModalMessage:"ui-agreements.duplicateAgreementModal.duplicateMessage",duplicateModalError:"ui-agreements.duplicateAgreementModal.duplicateModalError",invalidResponseError:"ui-agreements.duplicateAgreementModal.invalidResponseError"},e}return t=a,(r=[{key:"render",value:function(){return Object(O.jsx)(y.a,E(E({},this.props),{},{cloneableProperties:this.cloneableProperties,translationIds:this.translationIds}))}}])&&x(t.prototype,r),n&&x(t,n),a}(o.a.Component),C=r(2991),T=r(415),M=r(416);function q(e){return(q="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function I(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function _(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?I(Object(r),!0).forEach((function(t){F(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):I(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function F(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function N(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function B(e,t){return(B=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function z(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=J(e);if(t){var o=J(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return H(this,r)}}function H(e,t){if(t&&("object"===q(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}function J(e){return(J=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var U=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&B(e,t)}(i,e);var t,r,n,a=z(i);function i(e){var t;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,i),(t=a.call(this,e)).state={showDeleteConfirmationModal:!1,showDuplicateAgreementModal:!1},t.getSectionProps=function(e){var r=t.props,n=r.data,o=r.handlers;return{agreement:n.agreement,data:n,eresourcesFilterPath:n.eresourcesFilterPath,id:e,handlers:o,searchString:n.searchString}},t.openDeleteConfirmationModal=function(){t.setState({showDeleteConfirmationModal:!0})},t.closeDeleteConfirmationModal=function(){t.setState({showDeleteConfirmationModal:!1})},t.openDuplicateAgreementModal=function(){t.setState({showDuplicateAgreementModal:!0})},t.closeDuplicateAgreementModal=function(){t.setState({showDuplicateAgreementModal:!1})},t.getActionMenu=function(e){var r=e.onToggle,n=t.props.stripes,o=[];return n.hasPerm("ui-agreements.agreements.edit")&&(o.push(Object(O.jsx)(j.f,{buttonStyle:"dropdownItem",id:"clickable-dropdown-edit-agreement",onClick:t.props.handlers.onEdit,children:Object(O.jsx)(j.G,{icon:"edit",children:Object(O.jsx)(b.a,{id:"ui-agreements.agreements.edit"})})},"clickable-dropdown-edit-agreement")),o.push(Object(O.jsx)(j.f,{buttonStyle:"dropdownItem",id:"clickable-dropdown-duplicate-agreement",onClick:function(){t.openDuplicateAgreementModal(),r()},children:Object(O.jsx)(j.G,{icon:"duplicate",children:Object(O.jsx)(b.a,{id:"ui-agreements.agreements.duplicate"})})},"clickable-dropdown-duplicate-agreement"))),n.hasPerm("ui-agreements.agreements.view")&&o.push(Object(O.jsx)(j.f,{buttonStyle:"dropdownItem",id:"clickable-dropdown-export-agreement",onClick:function(){t.props.handlers.onExportAgreement(),r()},children:Object(O.jsx)(j.G,{icon:"download",children:Object(O.jsx)(b.a,{id:"ui-agreements.agreements.export"})})},"clickable-dropdown-export-agreement")),n.hasPerm("ui-agreements.agreements.delete")&&o.push(Object(O.jsx)(j.f,{buttonStyle:"dropdownItem",id:"clickable-dropdown-delete-agreement",onClick:function(){t.openDeleteConfirmationModal(),r()},children:Object(O.jsx)(j.G,{icon:"trash",children:Object(O.jsx)(b.a,{id:"ui-agreements.delete"})})},"clickable-dropdown-delete-agreement")),o.length?o:null},t.getInitialAccordionsState=function(){return{allPeriods:!1,controllingLicense:!1,externalLicenses:!1,futureLicenses:!1,historicalLicenses:!1,internalContacts:!1,lines:!1,notes:!1,organizations:!1,relatedAgreements:!1,supplementaryProperties:!1,supplementaryDocs:!1,terms:!1,usageData:!1}},t.renderEditAgreementPaneMenu=function(){var e=t.props,r=e.data.agreement,n=e.handlers;return e.stripes.hasPerm("ui-agreements.agreements.edit")?Object(O.jsx)(j.jb,{children:n.onToggleTags&&Object(O.jsx)(b.a,{id:"ui-agreements.agreements.showTags",children:function(e){var t,o;return Object(O.jsx)(j.H,{ariaLabel:e,badgeCount:null!==(t=null==r||null===(o=r.tags)||void 0===o?void 0:o.length)&&void 0!==t?t:0,icon:"tag",id:"clickable-show-tags",onClick:n.onToggleTags})}})}):null},t.accordionStatusRef=o.a.createRef(),t}return t=i,(r=[{key:"render",value:function(){var e,t,r,n,o,a,i,s,c,u,l,f,g,h,y,v=this,w=this.props,E=w.data,P=w.isLoading,R=w.handlers,x=w.helperApp,A=this.state,S=A.showDeleteConfirmationModal,k=A.showDuplicateAgreementModal,L={defaultWidth:"55%",dismissible:!0,id:"pane-view-agreement",onClose:R.onClose},q=(null===(e=E.agreement)||void 0===e?void 0:e.linkedLicenses)||[],I=q.filter((function(e){return e.status.value===M.i.CONTROLLING})),F=q.filter((function(e){return e.status.value===M.i.FUTURE})),N=q.filter((function(e){return e.status.value===M.i.HISTORICAL}));if(P)return Object(O.jsx)(j.Q,_({"data-loading":!0},L));var B=[{name:"edit",handler:R.onEdit},{name:"expandAllSections",handler:function(e){return Object(j.Jb)(e,v.accordionStatusRef)}},{name:"collapseAllSections",handler:function(e){return Object(j.Eb)(e,v.accordionStatusRef)}},{name:"duplicateRecord",handler:function(){v.openDuplicateAgreementModal()}}];return Object(O.jsx)(j.C,{commands:B,isWithinScope:j.Db,scope:document.body,children:Object(O.jsxs)(O.Fragment,{children:[Object(O.jsx)(j.db,_(_({actionMenu:this.getActionMenu,appIcon:Object(O.jsx)(d.b,{app:"agreements"}),lastMenu:this.renderEditAgreementPaneMenu(),paneTitle:E.agreement.name},L),{},{children:Object(O.jsxs)(d.k,{record:E.agreement.name,children:[Object(O.jsx)(C.n,_({},this.getSectionProps())),Object(O.jsx)(C.p,_({},this.getSectionProps("info"))),Object(O.jsxs)(j.c,{ref:this.accordionStatusRef,children:[Object(O.jsx)(j.sb,{end:"xs",children:Object(O.jsx)(j.k,{xs:!0,children:Object(O.jsx)(j.v,{})})}),Object(O.jsxs)(j.b,{initialStatus:this.getInitialAccordionsState(),children:[Object(O.jsx)(C.a,_({},this.getSectionProps("allPeriods"))),(null===(t=E.agreement)||void 0===t||null===(r=t.contacts)||void 0===r?void 0:r.length)>0&&Object(O.jsx)(C.q,_({},this.getSectionProps("internalContacts"))),Object(O.jsx)(C.r,_({},this.getSectionProps("lines"))),(null==I?void 0:I.length)>0&&Object(O.jsx)(C.b,_({},this.getSectionProps("controllingLicense"))),(null==F?void 0:F.length)>0&&Object(O.jsx)(C.m,_({},this.getSectionProps("futureLicenses"))),(null==N?void 0:N.length)>0&&Object(O.jsx)(C.o,_({},this.getSectionProps("historicalLicenses"))),(null===(n=E.agreement)||void 0===n||null===(o=n.externalLicenseDocs)||void 0===o?void 0:o.length)>0&&Object(O.jsx)(C.c,_({},this.getSectionProps("externalLicenses"))),(null==I?void 0:I.length)>0&&Object(O.jsx)(C.w,_({},this.getSectionProps("terms"))),(null===(a=E.agreement)||void 0===a||null===(i=a.orgs)||void 0===i?void 0:i.length)>0&&Object(O.jsx)(C.s,_({},this.getSectionProps("organizations"))),(null===(s=E.supplementaryProperties)||void 0===s?void 0:s.length)>0&&Object(O.jsx)(C.v,_({},this.getSectionProps("supplementaryProperties"))),(null===(c=E.agreement)||void 0===c||null===(u=c.supplementaryDocs)||void 0===u?void 0:u.length)>0&&Object(O.jsx)(C.u,_({},this.getSectionProps("supplementaryDocs"))),(null===(l=E.agreement)||void 0===l||null===(f=l.usageDataProviders)||void 0===f?void 0:f.length)>0&&Object(O.jsx)(C.x,_({},this.getSectionProps("usageData"))),(null===(g=E.agreement)||void 0===g||null===(h=g.relatedAgreements)||void 0===h?void 0:h.length)>0&&Object(O.jsx)(C.t,_({},this.getSectionProps("relatedAgreements"))),Object(O.jsx)(p.x,_(_({},this.getSectionProps("notes")),{},{domainName:"agreements",entityId:E.agreement.id,entityName:E.agreement.name,entityType:"agreement",pathToNoteCreate:T.h.noteCreate(),pathToNoteDetails:T.h.notes()}))]})]})]})})),x,k&&Object(O.jsx)(D,{name:E.agreement.name,onClone:function(e){return R.onClone(e)},onClose:this.closeDuplicateAgreementModal}),Object(O.jsx)(j.m,{buttonStyle:"danger",confirmLabel:Object(O.jsx)(b.a,{id:"ui-agreements.delete"}),heading:Object(O.jsx)(b.a,{id:"ui-agreements.agreements.deleteAgreement"}),id:"delete-agreement-confirmation",message:Object(O.jsx)(m.a,{id:"ui-agreements.agreements.deleteConfirmMessage",values:{name:null===(y=E.agreement)||void 0===y?void 0:y.name}}),onCancel:this.closeDeleteConfirmationModal,onConfirm:function(){R.onDelete(),v.closeDeleteConfirmationModal()},open:S})]})})}}])&&N(t.prototype,r),n&&N(t,n),i}(o.a.Component);U.propTypes={data:i.a.shape({agreement:i.a.object.isRequired,eresourcesFilterPath:i.a.string,searchString:i.a.string,supplementaryProperties:i.a.arrayOf(i.a.object)}).isRequired,handlers:i.a.shape({onClone:i.a.func.isRequired,onClose:i.a.func.isRequired,onDelete:i.a.func.isRequired,onEdit:i.a.func,onExportAgreement:i.a.func,onToggleTags:i.a.func}).isRequired,helperApp:i.a.node,isLoading:i.a.bool.isRequired,stripes:i.a.shape({hasPerm:i.a.func})};var V=Object(d.v)(U),X=r(2986);function G(e){return(G="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function K(e){return function(e){if(Array.isArray(e))return W(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||function(e,t){if(!e)return;if("string"==typeof e)return W(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);"Object"===r&&e.constructor&&(r=e.constructor.name);if("Map"===r||"Set"===r)return Array.from(e);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return W(e,t)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function W(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function Q(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function $(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?Q(Object(r),!0).forEach((function(t){Y(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Q(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function Y(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function Z(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function ee(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function te(e,t){return(te=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function re(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=oe(e);if(t){var o=oe(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return ne(this,r)}}function ne(e,t){if(t&&("object"===G(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}function oe(e){return(oe=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var ae=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&te(e,t)}(a,e);var t,r,n,o=re(a);function a(){var e;Z(this,a);for(var t=arguments.length,r=new Array(t),n=0;n<t;n++)r[n]=arguments[n];return(e=o.call.apply(o,[this].concat(r))).downloadBlob=function(e){return function(t){var r=window.URL.createObjectURL(t),n=document.createElement("a");n.href=r,n.download=e,document.body.appendChild(n),n.click(),n.remove()}},e.getCompositeAgreement=function(){var t,r=e.props.resources,n=Object(s.get)(r,"agreement.records[0]",{contacts:[],orgs:[]}),o=n.contacts.map((function(t){return $($({},t),{},{user:e.getRecord(t.user,"users")||t.user})})),a=Object(s.uniqBy)(Object(s.get)(r,"interfacesCredentials.records",[]),"id"),i=n.orgs.map((function(t){return $($({},t),{},{interfaces:Object(s.get)(t,"org.orgsUuid_object.interfaces",[]).map((function(t){return $($({},e.getRecord(t,"interfaces")||{}),{},{credentials:a.find((function(e){return e.interfaceId===t}))})}))})}));return Object(X.a)(n),$($({},n),{},{contacts:o,lines:e.getLinesRecords(),agreementLinesCount:null!==(t=Object(s.get)(r,"agreementLines.other.totalRecords"))&&void 0!==t?t:0,eresources:e.getAgreementEresourcesRecords(),eresourcesCount:Object(s.get)(r,"agreementEresources.other.totalRecords"),orderLines:Object(s.get)(r,"orderLines.records"),orgs:i})},e.getHelperApp=function(){var t=e.props,r=t.match,n=t.resources.query.helper;if(!n)return null;var o=null;return"tags"===n&&(o=f.a),o?Object(O.jsx)(o,{link:"erm/sas/".concat(r.params.id),onToggle:function(){return e.handleToggleHelper(n)}}):null},e.getAgreementEresourcesRecords=function(){var t,r,n,o=e.props,a=o.resources,i=o.match,s=null!==(t=null==a||null===(r=a.agreementEresources)||void 0===r?void 0:r.url)&&void 0!==t?t:"";if(-1!==s.indexOf("".concat(i.params.id))&&-1!==s.indexOf("resources/".concat(a.eresourcesFilterPath)))return null==a||null===(n=a.agreementEresources)||void 0===n?void 0:n.records},e.getLinesRecords=function(){var t,r,n,o=e.props,a=o.resources,i=o.match;if(-1!==(null!==(t=null==a||null===(r=a.agreementLines)||void 0===r?void 0:r.url)&&void 0!==t?t:"").indexOf("".concat(i.params.id)))return null==a||null===(n=a.agreementLines)||void 0===n?void 0:n.records},e.getRecord=function(t,r){return Object(s.get)(e.props.resources,"".concat(r,".records"),[]).find((function(e){return e.id===t}))},e.handleClone=function(t){var r,n,o=e.props,a=o.history,i=o.intl,s=o.location,c=o.match,u=o.resources,l=o.stripes.okapi,d=null==u||null===(r=u.agreement)||void 0===r||null===(n=r.records)||void 0===n?void 0:n[0].name;return fetch("".concat(l.url,"/erm/sas/").concat(c.params.id,"/clone"),{method:"POST",headers:{"X-Okapi-Tenant":l.tenant,"X-Okapi-Token":l.token,"Content-Type":"application/json"},body:JSON.stringify(t)}).then((function(e){if(e.ok)return e.text();if(422===e.status)return e.json().then((function(e){var t=e.errors;throw new Error(i.formatMessage({id:"ui-agreements.duplicateAgreementModal.".concat(t[0].i18n_code)},{name:d}))}));throw new Error(M.e.JSON_ERROR)})).then((function(e){var t=JSON.parse(e);if(t.id)return Promise.resolve(a.push("".concat(T.h.agreementEdit(t.id)).concat(s.search)));throw new Error(M.e.INVALID_JSON_ERROR)})).catch((function(e){throw e}))},e.handleClose=function(){e.props.history.push("".concat(T.h.agreements()).concat(e.props.location.search))},e.handleDelete=function(){var t,r,n,o=e.context.sendCallout,a=e.props,i=a.history,s=a.location,c=a.mutator,u=e.getCompositeAgreement();null!==(t=u.items)&&void 0!==t&&t.length?o({type:"error",timeout:0,message:Object(O.jsx)(m.a,{id:"ui-agreements.errors.noDeleteHasAgreementLines"})}):null!==(r=u.linkedLicenses)&&void 0!==r&&r.length?o({type:"error",timeout:0,message:Object(O.jsx)(m.a,{id:"ui-agreements.errors.noDeleteHasLicenses"})}):null!==(n=u.relatedAgreements)&&void 0!==n&&n.length?o({type:"error",timeout:0,message:Object(O.jsx)(m.a,{id:"ui-agreements.errors.noDeleteHasRelatedAgreements"})}):c.agreement.DELETE(u).then((function(){i.push("".concat(T.h.agreements()).concat(s.search)),o({message:Object(O.jsx)(m.a,{id:"ui-agreements.agreements.deletedAgreement",values:{name:u.name}})})})).catch((function(e){o({type:"error",timeout:0,message:Object(O.jsx)(m.a,{id:"ui-agreements.errors.noDeleteAgreementBackendError",values:{message:e.message}})})}))},e.handleFilterEResources=function(t){var r=e.props.mutator;r.eresourcesFilterPath.replace(t),r.agreementEresourcesOffset.replace(0)},e.handleEdit=function(){var t=e.props,r=t.history,n=t.location,o=t.match;r.push("".concat(T.h.agreementEdit(o.params.id)).concat(n.search))},e.handleExportAgreement=function(){var t=e.props,r=t.resources,n=t.stripes.okapi,o=Object(s.get)(r,"agreement.records[0]",{}),a=o.id,i=o.name;return fetch("".concat(n.url,"/erm/sas/").concat(a,"/export/current"),{headers:{"X-Okapi-Tenant":n.tenant,"X-Okapi-Token":n.token}}).then((function(e){return e.blob()})).then(e.downloadBlob(i))},e.handleExportEResourcesAsJSON=function(){var t=e.props,r=t.resources,n=t.stripes.okapi,o=Object(s.get)(r,"agreement.records[0]",{}),a=o.id,i=o.name;return fetch("".concat(n.url,"/erm/sas/").concat(a,"/resources/export/").concat(r.eresourcesFilterPath),{headers:{"X-Okapi-Tenant":n.tenant,"X-Okapi-Token":n.token}}).then((function(e){return e.blob()})).then(e.downloadBlob(i))},e.handleExportEResourcesAsKBART=function(){var t=e.props,r=t.resources,n=t.stripes.okapi,o=Object(s.get)(r,"agreement.records[0]",{}),a=o.id,i=o.name;return fetch("".concat(n.url,"/erm/sas/").concat(a,"/resources/export/").concat(r.eresourcesFilterPath,"/kbart"),{headers:{"X-Okapi-Tenant":n.tenant,"X-Okapi-Token":n.token}}).then((function(e){return e.blob()})).then(e.downloadBlob(i))},e.handleFetchCredentials=function(t){e.props.mutator.interfaceRecord.replace({id:t})},e.handleNeedMoreLines=function(t,r){e.props.mutator.agreementLinesOffset.replace(r)},e.handleNeedMoreEResources=function(t,r){e.props.mutator.agreementEresourcesOffset.replace(r)},e.handleToggleHelper=function(t){var r=e.props,n=r.mutator,o=r.resources.query.helper!==t?t:null;n.query.update({helper:o})},e.handleToggleTags=function(){e.handleToggleHelper("tags")},e.handleViewAgreementLine=function(t){var r=e.props,n=r.history,o=r.location,a=r.match;n.push("".concat(T.h.agreementLineView(a.params.id,t)).concat(o.search))},e.isLoading=function(){var t=e.props,r=t.match,n=t.resources;return r.params.id!==Object(s.get)(n,"agreement.records[0].id")&&Object(s.get)(n,"agreement.isPending",!0)},e}return t=a,(r=[{key:"componentDidUpdate",value:function(e){var t,r,n,o,a,i,s,c,u,l=this.props.mutator;(null==e||null===(t=e.resources)||void 0===t||null===(r=t.agreement)||void 0===r||null===(n=r.records)||void 0===n||null===(o=n[0])||void 0===o?void 0:o.id)!==(null===(a=this.props)||void 0===a||null===(i=a.resources)||void 0===i||null===(s=i.agreement)||void 0===s||null===(c=s.records)||void 0===c||null===(u=c[0])||void 0===u?void 0:u.id)&&(l.agreementEresourcesOffset.replace(0),l.agreementLinesOffset.replace(0))}},{key:"render",value:function(){var e=this.props,t=e.handlers,r=e.resources,n=e.tagsEnabled;return Object(O.jsx)(V,{data:{agreement:this.getCompositeAgreement(),eresourcesFilterPath:this.props.resources.eresourcesFilterPath,searchString:this.props.location.search,supplementaryProperties:Object(s.get)(r,"supplementaryProperties.records",[]),terms:Object(s.get)(r,"terms.records",[])},handlers:$($({},t),{},{onClone:this.handleClone,onClose:this.handleClose,onDelete:this.handleDelete,onEdit:this.handleEdit,onExportAgreement:this.handleExportAgreement,onExportEResourcesAsJSON:this.handleExportEResourcesAsJSON,onExportEResourcesAsKBART:this.handleExportEResourcesAsKBART,onFetchCredentials:this.handleFetchCredentials,onFilterEResources:this.handleFilterEResources,onNeedMoreEResources:this.handleNeedMoreEResources,onNeedMoreLines:this.handleNeedMoreLines,onToggleTags:n?this.handleToggleTags:void 0,onViewAgreementLine:this.handleViewAgreementLine}),helperApp:this.getHelperApp(),isLoading:this.isLoading()},Object(s.get)(r,"agreement.loadedAt","loading"))}}])&&ee(t.prototype,r),n&&ee(t,n),a}(o.a.Component);ae.manifest=Object.freeze({agreement:{type:"okapi",path:"erm/sas/:{id}",shouldRefresh:Object(g.a)({agreement:["DELETE"]})},agreementLines:{type:"okapi",path:"erm/entitlements",limitParam:"perPage",perRequest:function(e,t,r,n,o){var a;return Object(T.g)(null===(a=o.resources)||void 0===a?void 0:a.settings,"agreementLines")},params:{filters:"owner=:{id}",sort:"resource.name",stats:"true"},records:"results",resultOffset:function(e,t,r,n,o){var a,i,s,c=o.match,u=o.resources,l=null==u?void 0:u.agreementLinesOffset;return(null==u||null===(a=u.agreement)||void 0===a||null===(i=a.records)||void 0===i||null===(s=i[0])||void 0===s?void 0:s.id)!==c.params.id?0:l},shouldRefresh:Object(g.a)({agreement:["DELETE"]})},agreementEresources:{type:"okapi",path:"erm/sas/:{id}/resources/%{eresourcesFilterPath}",limitParam:"perPage",perRequest:function(e,t,r,n,o){var a;return Object(T.g)(null===(a=o.resources)||void 0===a?void 0:a.settings,"agreementEresources")},records:"results",resultOffset:function(e,t,r,n,o){var a,i,s,c=o.match,u=o.resources,l=null==u?void 0:u.agreementEresourcesOffset;return(null==u||null===(a=u.agreement)||void 0===a||null===(i=a.records)||void 0===i||null===(s=i[0])||void 0===s?void 0:s.id)!==c.params.id?0:l},params:{sort:"pti.titleInstance.name;asc",stats:"true"},shouldRefresh:Object(g.a)({agreement:["DELETE"]})},eresourcesFilterPath:{initialValue:"current"},interfaces:{type:"okapi",path:"organizations-storage/interfaces",perRequest:100,params:function(e,t,r,n,o){var a=Object(s.get)(o.resources,"agreement.records[0].orgs",[]),i=Object(s.flatten)(a.map((function(e){return Object(s.get)(e,"org.orgsUuid_object.interfaces",[])}))),c=K(new Set(i.map((function(e){return"id==".concat(e)})))).join(" or ");return c?{query:c}:null},fetch:function(e){return!!e.stripes.hasInterface("organizations-storage.interfaces","2.0")},permissionsRequired:"organizations-storage.interfaces.collection.get",records:"interfaces"},orderLines:{type:"okapi",path:"orders/order-lines",params:function(e,t,r,n,o){var a=Object(s.get)(o.resources,"agreementLines.records",[]).filter((function(e){return e.poLines&&e.poLines.length})).map((function(e){return e.poLines.map((function(e){return"id==".concat(e.poLineId)})).join(" or ")})).join(" or ");return a?{query:a}:null},fetch:function(e){return!!e.stripes.hasInterface("order-lines","1.0 2.0")},records:"poLines",throwErrors:!1},settings:{type:"okapi",path:"configurations/entries?query=(module=AGREEMENTS and configName=general)",records:"configs"},supplementaryProperties:{type:"okapi",path:"erm/custprops",shouldRefresh:Object(g.a)({agreement:["DELETE"]})},terms:{type:"okapi",path:"licenses/custprops"},users:{type:"okapi",path:"users",perRequest:100,params:function(e,t,r,n,o){var a=Object(s.get)(o.resources,"agreement.records[0].contacts",[]).filter((function(e){return e.user})).map((function(e){return"id==".concat(e.user)})).join(" or ");return a?{query:a}:null},fetch:function(e){return!!e.stripes.hasInterface("users","15.0")},permissionsRequired:"users.collection.get",records:"users"},interfacesCredentials:{clientGeneratePk:!1,throwErrors:!1,path:"organizations-storage/interfaces/%{interfaceRecord.id}/credentials",type:"okapi",pk:"FAKE_PK",permissionsRequired:"organizations-storage.interfaces.credentials.item.get",fetch:function(e){return!!e.stripes.hasInterface("organizations-storage.interfaces","1.0 2.0")}},interfaceRecord:{},agreementEresourcesOffset:{initialValue:0},agreementLinesOffset:{initialValue:0},query:{}}),ae.propTypes={handlers:i.a.object,history:i.a.shape({push:i.a.func.isRequired}).isRequired,intl:i.a.object,location:i.a.shape({search:i.a.string.isRequired}).isRequired,match:i.a.shape({params:i.a.shape({id:i.a.string.isRequired}).isRequired}).isRequired,mutator:i.a.shape({agreement:i.a.shape({DELETE:i.a.func.isRequired}),eresourcesFilterPath:i.a.shape({replace:i.a.func}),interfaceRecord:i.a.shape({replace:i.a.func}),agreementEresourcesOffset:i.a.shape({replace:i.a.func}).isRequired,agreementLinesOffset:i.a.shape({replace:i.a.func}).isRequired,query:i.a.shape({update:i.a.func.isRequired}).isRequired}).isRequired,resources:i.a.shape({agreement:i.a.object,agreementLines:i.a.object,agreementEresources:i.a.object,eresourcesFilterPath:i.a.string,interfaces:i.a.object,orderLines:i.a.object,query:i.a.object,settings:i.a.object,users:i.a.object}).isRequired,stripes:i.a.shape({hasInterface:i.a.func.isRequired,hasPerm:i.a.func.isRequired,okapi:i.a.shape({tenant:i.a.string.isRequired,token:i.a.string.isRequired,url:i.a.string.isRequired}).isRequired}).isRequired,tagsEnabled:i.a.bool},ae.defaultProps={handlers:{}},ae.contextType=d.c;t.default=u()(l.c,h.a,d.o,p.U)(ae)}}]);