(window.webpackJsonp=window.webpackJsonp||[]).push([[21],{2748:function(e,t,n){"use strict";n.r(t);var r=n(3),i=n.n(r),o=n(1),s=n.n(o),a=n(142),c=n.n(a),l=n(4),u=n(2),d=n(7),p=n(20),b=n(2988),f=n(415),h=n(0);function m(e){return(m="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}var y=["linkedResource","type"];function j(e,t){if(null==e)return{};var n,r,i=function(e,t){if(null==e)return{};var n,r,i={},o=Object.keys(e);for(r=0;r<o.length;r++)n=o[r],t.indexOf(n)>=0||(i[n]=e[n]);return i}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(r=0;r<o.length;r++)n=o[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(i[n]=e[n])}return i}function O(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function g(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?O(Object(n),!0).forEach((function(t){v(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):O(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function v(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function k(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function x(e,t){return(x=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function w(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=E(e);if(t){var i=E(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return S(this,n)}}function S(e,t){if(t&&("object"===m(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}function E(e){return(E=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var R=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&x(e,t)}(o,e);var t,n,r,i=w(o);function o(e){var t;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,o),(t=i.call(this,e)).getCompositeLine=function(){var e,n,r,i,o=t.props.resources,s=null!==(e=null===(n=o.line)||void 0===n||null===(r=n.records)||void 0===r?void 0:r[0])&&void 0!==e?e:{},a=(null===(i=o.orderLines)||void 0===i?void 0:i.records)||[],c=(s.poLines||[]).map((function(e){return a.find((function(t){return t.id===e.poLineId}))})).filter((function(e){return e}));return g(g({},s),{},{poLines:c})},t.getInitialValues=function(){var e,n,r,i=null!==(e=null===(n=t.props.resources.line)||void 0===n||null===(r=n.records)||void 0===r?void 0:r[0])&&void 0!==e?e:{};return g(g({},i),{},{linkedResource:"detached"!==i.type?i:void 0,coverage:i.customCoverage?i.coverage:void 0})},t.handleClose=function(){var e=t.props,n=e.history,r=e.location,i=e.match.params,o=i.agreementId,s=i.lineId;n.push("".concat(f.h.agreementLineView(o,s)).concat(r.search))},t.handleSubmit=function(e){var n,r=t.props,i=r.history,o=r.location,s=r.match.params,a=s.agreementId,c=s.lineId,u=r.mutator,d=e.linkedResource,b=e.type,m=j(e,y);return n="packages"===(null==d?void 0:d.type)?g(g({type:"external",authority:"ekb-package",reference:d.id},m),{},{resource:null}):"resources"===(null==d?void 0:d.type)?g(g({type:"external",authority:"ekb-title",reference:d.id},m),{},{resource:null}):Object(l.isEmpty)(d)?g(g({type:"detached"},m),{},{resource:null}):"detached"===b?g(g({resource:d},m),{},{type:null}):"external"===b?g(g({resource:null},m),{},{type:"external"}):g(g({resource:d},m),{},{type:b}),u.entitlements.PUT(g({id:c},n)).then((function(e){var n=e.id;t.context.sendCallout({message:Object(h.jsx)(p.a,{id:"ui-agreements.line.update.callout"})}),i.push("".concat(f.h.agreementLineView(a,n)).concat(o.search))}))},t.isLoading=function(){return Object.values(t.props.resources).some((function(e){return"settings"!==e.resource&&e.isPending}))},t.state={isEholdingsEnabled:e.stripes.hasPerm("module.eholdings.enabled")},t}return t=o,(n=[{key:"render",value:function(){var e,t,n,r=this.props,i=r.match,o=r.resources,s=r.isSuppressFromDiscoveryEnabled;return this.isLoading()?Object(h.jsx)(u.R,{dismissible:!0,onClose:this.handleClose}):Object(h.jsx)(b.a,{data:{basket:null!==(n=null==o?void 0:o.basket)&&void 0!==n?n:[],line:this.getCompositeLine()},handlers:g(g({},this.props.handlers),{},{isSuppressFromDiscoveryEnabled:s,onClose:this.handleClose}),initialValues:this.getInitialValues(),isEholdingsEnabled:this.state.isEholdingsEnabled,isLoading:this.isLoading(),lineId:i.params.lineId,onSubmit:this.handleSubmit},null!==(e=null===(t=o.line)||void 0===t?void 0:t.loadedAt)&&void 0!==e?e:"loading")}}])&&k(t.prototype,n),r&&k(t,r),o}(i.a.Component);R.manifest=Object.freeze({entitlements:{type:"okapi",path:"erm/entitlements",fetch:!1},line:{type:"okapi",path:"erm/entitlements/:{lineId}"},orderLines:{type:"okapi",path:"orders/order-lines",params:function(e,t,n,r,i){var o,s,a,c,l=(null!==(o=null===(s=i.resources.line)||void 0===s||null===(a=s.records)||void 0===a||null===(c=a[0])||void 0===c?void 0:c.poLines)&&void 0!==o?o:[]).map((function(e){return"id==".concat(e.poLineId)})).join(" or ");return l?{query:l}:null},fetch:function(e){return!!e.stripes.hasInterface("order-lines","1.0 2.0")},records:"poLines",throwErrors:!1},basket:{initialValue:[]}}),R.propTypes={handlers:s.a.object,history:s.a.shape({push:s.a.func.isRequired}).isRequired,isSuppressFromDiscoveryEnabled:s.a.func.isRequired,location:s.a.shape({search:s.a.string.isRequired}).isRequired,match:s.a.shape({params:s.a.shape({agreementId:s.a.string.isRequired,lineId:s.a.string.isRequired}).isRequired}).isRequired,mutator:s.a.shape({entitlements:s.a.shape({PUT:s.a.func.isRequired})}),resources:s.a.shape({basket:s.a.arrayOf(s.a.object),line:s.a.object,orderLines:s.a.object,settings:s.a.object}).isRequired,stripes:s.a.shape({hasInterface:s.a.func.isRequired,hasPerm:s.a.func.isRequired}).isRequired},R.contextType=d.c,t.default=c()(d.o,f.j)(R)},2988:function(e,t,n){"use strict";var r=n(3),i=n(1),o=n.n(i),s=n(4),a=n(29),c=n(120),l=n(1391),u=n(2),d=n(7),p=n(22),b=n(2992),f=n(993),h=n(415),m=n(0);function y(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function j(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?y(Object(n),!0).forEach((function(t){O(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):y(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function O(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function g(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null==n)return;var r,i,o=[],s=!0,a=!1;try{for(n=n.call(e);!(s=(r=n.next()).done)&&(o.push(r.value),!t||o.length!==t);s=!0);}catch(e){a=!0,i=e}finally{try{s||null==n.return||n.return()}finally{if(a)throw i}}return o}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return v(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return v(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function v(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var k={data:o.a.shape({basket:o.a.arrayOf(o.a.object),line:o.a.shape({resource:o.a.shape({_object:o.a.object})}),settings:o.a.object}),form:o.a.shape({mutators:o.a.shape({setFieldData:o.a.func}),getRegisteredFields:o.a.func.isRequired}).isRequired,handlers:o.a.PropTypes.shape({isSuppressFromDiscoveryEnabled:o.a.func.isRequired,onClose:o.a.func.isRequired}),handleSubmit:o.a.func.isRequired,isEholdingsEnabled:o.a.bool,lineId:o.a.string,onSubmit:o.a.func,pristine:o.a.bool,submitting:o.a.bool,values:o.a.object},x=function(e){var t,n,i=e.data,o=i.basket,c=void 0===o?[]:o,p=i.line,y=void 0===p?{}:p,O=e.form,v=e.handlers,k=e.handleSubmit,x=e.isEholdingsEnabled,w=e.lineId,S=void 0===w?"":w,E=e.pristine,R=e.submitting,P=e.values,C=O.getRegisteredFields().length>0,I=Object(h.f)(y)?y:null!==(t=null===(n=y.resource)||void 0===n?void 0:n._object)&&void 0!==t?t:{},q=g(Object(r.useState)("basket"),2),D=q[0],L=q[1],T=Object(r.useRef)(),F=[{name:"save",handler:function(e){return Object(l.a)(e,{handleSubmit:k,pristine:E,submitting:R})}},{name:"expandAllSections",handler:function(e){return Object(u.Jb)(e,T)}},{name:"collapseAllSections",handler:function(e){return Object(u.Eb)(e,T)}}],A=function(){return{addButtonTooltipId:"ui-agreements.agreementLine.addCustomCoverageTootlip",agreementLineSource:D,basket:c,isSuppressFromDiscoveryEnabled:v.isSuppressFromDiscoveryEnabled,line:y,lineId:S,resource:I,setFieldData:O.mutators.setFieldData,values:P}};return Object(m.jsx)(u.C,{commands:F,isWithinScope:u.Db,scope:document.body,children:Object(m.jsx)(u.kb,{children:Object(m.jsxs)(u.db,{appIcon:Object(m.jsx)(d.b,{app:"agreements"}),centerContent:!0,defaultWidth:"100%",dismissible:!0,footer:Object(m.jsx)(u.gb,{renderEnd:Object(m.jsx)(u.f,{buttonStyle:"primary mega",disabled:E||R,id:"clickable-update-agreement-line",marginBottom0:!0,onClick:k,type:"submit",children:Object(m.jsx)(a.a,{id:"stripes-components.saveAndClose"})}),renderStart:Object(m.jsx)(u.f,{buttonStyle:"default mega",id:"clickable-cancel",marginBottom0:!0,onClick:v.onClose,children:Object(m.jsx)(a.a,{id:"stripes-components.cancel"})})}),id:"pane-agreement-line-form",onClose:v.onClose,paneTitle:S?Object(m.jsx)(a.a,{id:"ui-agreements.line.edit"}):Object(m.jsx)(a.a,{id:"ui-agreements.line.new"}),children:[C?Object(m.jsx)("div",{id:"form-loaded"}):null,(!y.id||Object(h.e)(y))&&(x?Object(m.jsx)(f.default,{children:function(e){return e.isEnabled?Object(m.jsxs)(u.g,{children:[Object(m.jsx)(u.f,{buttonStyle:"basket"===D?"primary":"default",disabled:"eholdings"===D&&!Object(s.isEmpty)(P.linkedResource),id:"clickable-nav-agreements",onClick:function(){L("basket")},children:Object(m.jsx)(a.a,{id:"ui-agreements.agreementLine.basket"})}),Object(m.jsx)(u.f,{buttonStyle:"eholdings"===D?"primary":"default",disabled:"basket"===D&&!Object(s.isEmpty)(P.linkedResource),id:"clickable-nav-eresources",onClick:function(){L("eholdings")},children:Object(m.jsx)(a.a,{id:"ui-agreements.agreementLine.eholdings"})})]}):(L("eholdings"),null)}}):Object(m.jsx)(f.default,{children:function(e){var t=e.isEnabled;return L(t?"basket":""),null}})),Object(m.jsx)(b.c,j({},A())),Object(m.jsx)(b.d,j({},A())),Object(m.jsxs)(u.c,{ref:T,children:[Object(m.jsx)(u.sb,{end:"xs",children:Object(m.jsx)(u.k,{xs:!0,children:Object(m.jsx)(u.v,{id:"clickable-expand-all"})})}),Object(m.jsxs)(u.b,{children:[Object(m.jsx)(b.e,j({},A())),"basket"===D&&Object(m.jsx)(b.b,j({},A()))]})]})]})})})};x.propTypes=k,t.a=Object(p.a)({initialValuesEqual:function(e,t){return Object(s.isEqual)(e,t)},keepDirtyOnReinitialize:!0,subscription:{values:!0},mutators:{setFieldData:c.a},navigationCheck:!0})(x)}}]);